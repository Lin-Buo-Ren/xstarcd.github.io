<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="Stylesheet" type="text/css" href="../styles/style.css" />
    <title>MySQL</title>
</head>
<body>
<div id="header">
    <ul id="top-nav">
    <li><a href="../index.html">首页</a></li>
    <li><a href="index.html">分类首页</a></li>
    </ul>
</div>
<div id="cse"></div>
<div id="main">

<div class="toc">
<ul>
<li><a href="#toc_1">MySQL_5.5</a>
<li><a href="#toc_2">MySQL</a>
<ul>
<li><a href="#toc_2.1">MySQL常用操作</a>
<li><a href="#toc_2.2">MySQL复制</a>
<li><a href="#toc_2.3">MySQL设置参数</a>
<li><a href="#toc_2.4">MySQL性能分析</a>
</ul>
</ul>
</div>

<h1 id="toc_1"><a href="MySQL_5.5.html">MySQL_5.5</a></h1>

<h1 id="toc_2">MySQL</h1>

<ul>
<li>
Mariadb Galera Cluster

<ul>
<li>
官方网站: <a href="https://mariadb.org/">https://mariadb.org/</a>

<li>
Galera/Mariadb数据库集群配置笔记:<a href="http://www.server110.com/mysql/201312/4085.html">http://www.server110.com/mysql/201312/4085.html</a>

<li>
MySQL Galera Cluster数据库集群配置教程:<a href="http://www.server110.com/mysql/201312/4087.html">http://www.server110.com/mysql/201312/4087.html</a>

</ul>
<li>
<a href="SchemaSpy.html">用SchemaSpy生成数据库结构文档</a>

<li>
<a href="mysqlslap.html">MySQL自带的性能压力测试工具mysqlslap</a>

<li>
日志分析工具mysqlsla

<li>
MySQL衍生版 Percona Server:Percona 为 MySQL 数据库服务器进行了改进，在功能和性能上较 MySQL 有着很显著的提升。该版本提升了在高负载情况下的 InnoDB 的性能、为 DBA 提供一些非常有用的性能诊断工具；另外有更多的参数和命令来控制服务器行为。

<ul>
<li>
<a href="http://www.oschina.net/p/percona+server">http://www.oschina.net/p/percona+server</a> 

</ul>
<li>
MySQL Utilities:

<ul>
<li>
<a href="http://dev.mysql.com/downloads/utilities/">http://dev.mysql.com/downloads/utilities/</a>

<li>
MySQL管理利器MySQL Utilities教程:<a href="http://www.ttlsa.com/mysql/mysql-manager-tools-mysql-utilities-tutorial/">http://www.ttlsa.com/mysql/mysql-manager-tools-mysql-utilities-tutorial/</a>

</ul>
<li>
HAProxy + Pacemaker实现MySQL的高可用负载均衡: <a href="http://blog.itpub.net/14431099/viewspace-1316655/">http://blog.itpub.net/14431099/viewspace-1316655/</a>

<li>
Linux上MySQL优化三板斧:<a href="http://www.eit.name/blog/read.php?558">http://www.eit.name/blog/read.php?558</a>

<ul>
<li>
CPU方面

<ul>
<li>
在BIOS中关闭电源保护模式，保证MySQL能够充分利用CPU的资源。

</ul>
<li>
内存：

<ul>
<li>
vm.swappiness = 0

<ul>
<li>
<code>echo "vm.swappiness = 0" &gt;&gt;/etc/sysctl.conf;sysctl -p</code>

<li>
vm.swappiness设置为0表示尽量少swap，100表示尽量将inactive的内存页交换出去。设置为0让InnoDB自己管理缓存。

<li>
观察incative内存：

<ul>
<li>
<code>vmstat -an 1</code>的inact列

<li>
<code>cat /proc/meminfo</code>

</ul>
</ul>
<li>
关闭numa

<ul>
<li>
在BIOS中关闭

<li>
在操作系统中关闭:可以直接在/etc/grub.conf的kernel行最后添加<code>numa=off</code>。另外可以设置<code>vm.zone_reclaim_mode=0</code>尽量回收内存。

<li>
启动MySQL的时候，关闭NUMA特性：<code>numactl --interleave=all  mysqld &amp;</code>

</ul>
</ul>
<li>
文件系统：

<ul>
<li>
用noatime，nobarrier挂载系统

<ul>
<li>
对于ext3, ext4和 reiserfs文件系统可以在mount时指定barrier=0；对于xfs可以指定nobarrier选项。 

</ul>
<li>
IO调度策略修改为deadline。

<ul>
<li>
deadline兼顾到一个请求不会在队列中等待太久导致饿死，对数据库这种应用来说更加适用。 

<li>
将sda的调度策略设置为deadline:<code>echo deadline &gt;/sys/block/sda/queue/scheduler</code>

<li>
也可以直接在/etc/grub.conf的kernel行最后添加<code>elevator=deadline</code>来永久生效。

</ul>
</ul>
</ul>
</ul>


<h2 id="toc_2.1">MySQL常用操作</h2>

<ul>
<li>
修改mysql密码、建库、备份
<pre class="brush: bash">
UPDATE mysql.user SET Password = PASSWORD('mysqlrootpasswd') WHERE User = 'root';
FLUSH PRIVILEGES;

CREATE DATABASE `Jwikitestdb` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
GRANT ALL ON `Jwikitestdb`.* TO 'Jwikitest'@'127.0.0.1' IDENTIFIED BY 'dbpassword';

dbname="Jwikitestdb" &amp;&amp; mysqldump -uroot -p --default-character-set=utf8 --opt \
--extended-insert=false --triggers -R --hex-blob --single-transaction \
"$dbname" | gzip &gt; /bak/backups/$dbname.bak.`date +'%Y%m%d'`_1.dump.gz

dbnames="ccgw_jboss count_jboss dc dc_big_data dc_jboss dc_log fgw_jboss mgw_jboss portal_jboss vtgw_jboss test";
date;mysqldump -uroot -p --default-character-set=utf8 --opt --extended-insert=false --triggers -R --hex-blob \
 --single-transaction --flush-logs --master-data=2 --databases $dbnames| gzip &gt; DBs.bak.`date +'%Y%m%d'`.dump.gz;date

# 转换IP地址为数值形式
SELECT INET_ATON('192.168.0.1');
</pre>

</ul>

<ul>
<li>
replace、substring_index使用

</ul>

<p>
SUBSTRING_INDEX(str,delim,num)，其返回在str中第num个delim之前或之后的字符串，若num为正则为向前取，为负则为向后取。
</p>

<pre class="brush:sql">

select SUBSTRING_INDEX('abcdefg','d',1);
-- 向前取，返回字符串abc
select SUBSTRING_INDEX('abcdefg','d',-1);
-- 向后取，返回efg
select SUBSTRING_INDEX(SUBSTRING_INDEX('abcdefg','d',-1),'g',1);
-- 取中间，返回ef

-- replace替换范例
select id,
REPLACE(paramObj,CONCAT(',"header":{',SUBSTRING_INDEX(SUBSTRING_INDEX(paramObj,'{',-1),'}',2)),'') as opt
from RemoteOperationCmdHistory limit 1;
</pre>

<h2 id="toc_2.2"><a href="MySQL_replicate.html">MySQL复制</a></h2>

<h2 id="toc_2.3">MySQL设置参数</h2>

<h2 id="toc_2.4">MySQL性能分析</h2>

<ul>
<li>
日志分析工具

<li>
监测工具

<li>
运行状态分析

<li>
分布式数据库代理Amoeba:<a href="http://amoeba.meidusa.com">http://amoeba.meidusa.com</a>  <a href="http://dbanotes.net/arch/amoeba_interview.html">http://dbanotes.net/arch/amoeba_interview.html</a>

<li>
explain

</ul>

</div>
<div id="footer">
<p>
&copy; 2012 - 2015 XStar
&nbsp;|&nbsp;<a href="http://code.google.com/p/vimwiki/" title="vimwiki">Powerby:Vimwiki</a>
&nbsp;|&nbsp;<a href="http://kwiki.github.io" title="丘迟">Style:丘迟</a>
&nbsp;|&nbsp;<a href="../index.html">首页</a>
&nbsp;|&nbsp;<a href="index.html">分类首页</a>
&nbsp;|&nbsp;<a href="../SiteMap.html">站点地图</a>
</p>
</div>
<script type="text/javascript">var vimwiki_rootpath="../";</script>
<script type="text/javascript" src="http://cdn.staticfile.org/jquery/2.0.0/jquery.min.js"></script>
<script type="text/javascript" src="../scripts/vimwiki.js"></script>
</body>
</html>

