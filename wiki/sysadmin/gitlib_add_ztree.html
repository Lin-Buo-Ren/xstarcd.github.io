<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="Stylesheet" type="text/css" href="../styles/style.css" />
    <title>用ztree给gitlab wiki生成TOC</title>
</head>
<body>
<div id="header">
    <ul id="top-nav">
    <li><a href="../index.html">首页</a></li>
    <li><a href="index.html">分类首页</a></li>
    </ul>
</div>
<div id="cse"></div>
<div id="main">

<h1>用ztree给gitlab wiki生成TOC</h1>
<div class="toc">
<ul>
<li><a href="#toc_0.1">ztree</a>
<li><a href="#toc_0.2">添加至gitlab页面</a>
<ul>
<li><a href="#toc_0.2.1">注入方式</a>
<li><a href="#toc_0.2.2">添加说明</a>
</ul>
</ul>
</ul>
</div>

<h2 id="toc_0.1">ztree</h2>

<ul>
<li>
官网：<a href="http://www.ztree.me">http://www.ztree.me</a>

<li>
源码：

<ul>
<li>
<a href="https://github.com/i5ting/i5ting_ztree_toc">https://github.com/i5ting/i5ting_ztree_toc</a>

<li>
<a href="https://git.oschina.net/zTree/zTree_v3">https://git.oschina.net/zTree/zTree_v3</a>

</ul>
<li>
介绍：<a href="https://ruby-china.org/topics/17028">https://ruby-china.org/topics/17028</a>

<li>
Demo：<a href="http://i5ting.github.io/i5ting_ztree_toc/build/jquery.plugin.html">http://i5ting.github.io/i5ting_ztree_toc/build/jquery.plugin.html</a>

<li>
ztree_toc基础文件:<a href="../files/ztreetoc/ztree_3.5.tar.gz">ztree_3.5.tar.gz</a>

</ul>

<h2 id="toc_0.2">添加至gitlab页面</h2>

<p>
用下面的方式可以给gitlab的wiki和markdown页面生成TOC(Table of Contents)，翻阅篇幅长的文档变得轻松多了。
</p>

<h3 id="toc_0.2.1">注入方式</h3>

<ul>
<li>
注入方法：

<ol>
<li>
用浏览器进入gitlab的Wiki页面、或者md文件查看页面;

<li>
将下面的代码复制、粘贴到浏览器地址栏，按回车键即可完成注入(注意<code>javascript:</code>前缀可能会被浏览器删除，需手工补上)；

<li>
也可以将代码设置为浏览器书签，以后点击该书签即可加载目录。

</ol>
</ul>

<pre class="brush:javascript">
javascript:$('head').append("&lt;script src='http://xstarcd.github.io/wiki/files/ztreetoc/ldztree.js'&gt;&lt;script&gt;");void(0);
//或者
javascript:$('head').append("&lt;script src='http://dwz.cn/W9zZw'&gt;&lt;script&gt;");void(0);
</pre>

<ul>
<li>
说明：

<ol>
<li>
因外部资源加载和内容解析，显示目录约需要2-3秒时间(受网速影响)。

<li>
点击左上角的"HideToc"可隐藏/显示目录；

<li>
测试Firefox,Chrome工作正常；

<li>
注入时会自动检测当前页面是否为wiki或markdown页面，若不是则不会注入目录；

<li>
你也可以将这行代码添加到gitlab服务器的模版文件中，实现自动加载。

</ol>
</ul>

<ul>
<li>
已知问题：

<ul>
<li>
注入后所有标题上的链接会被删除。

<li>
github.com的HTTP Header中添加了CSP(Content Security Policy)控制，无法通过JS注入方式生成目录。
<pre>
content-security-policy: default-src *; script-src assets-cdn.github.com collector-cdn.github.com;...
</pre>

<li>
github的Wiki或markdown可在chrome浏览器中安装github-toc插件来实现：

<ul>
<li>
<a href="https://github.com/summerblue/github-toc">https://github.com/summerblue/github-toc</a>

<li>
<a href="https://chrome.google.com/webstore/detail/github-toc/nalkpgbfaadkpckoadhlkihofnbhfhek">https://chrome.google.com/webstore/detail/github-toc/nalkpgbfaadkpckoadhlkihofnbhfhek</a>

</ul>
</ul>
</ul>

<h3 id="toc_0.2.2">添加说明</h3>

<pre class="brush:html">
&lt;!DOCTYPE html&gt;
...
...
&lt;meta content="authenticity_token" name="csrf-param"&gt;
&lt;meta content="xW13ZWv9x6FCUK0yrbn5dbYv3RPu/q1ZBL2Us/T449k=" name="csrf-token"&gt;
...
...
&lt;!--ztree--&gt;
&lt;!--link rel="stylesheet" href="http://i5ting.github.io/i5ting_ztree_toc/build/style/zTreeStyle/zTreeStyle.css" type="text/css"--&gt;
&lt;link rel="stylesheet" href="ztree/zTreeStyle.css" type="text/css"&gt;
&lt;style&gt;
.ztree li a.curSelectedNode {
  padding-top: 0px;
  background-color: #FFE6B0;
  color: black;
  height: 16px;
  border: 1px #FFB951 solid;
  opacity: 0.8;
}
.ztree{
  overflow: auto;
  height:100%;
  min-height: 200px;
  top: 0px;
}
&lt;/style&gt;
&lt;!--ztree--&gt;

&lt;/head&gt;

&lt;body class="ui_mars  project" data-page="projects:blob:show" data-project-id="13"&gt;
&lt;header class="navbar navbar-fixed-top navbar-gitlab"&gt;
&lt;div class="navbar-inner"&gt;

&lt;!--ztree--&gt;
&lt;div style='width:30%;'&gt;
 &lt;ul id="tree" class="ztree" style='width:100%'&gt;
 &lt;/ul&gt;
&lt;/div&gt;
&lt;!--ztree--&gt;

&lt;div class="container"&gt;
...
...
...

&lt;div class="file-content wiki"&gt;

...
...
...



&lt;!--ztree--&gt;
&lt;!--
&lt;script src='http://i5ting.github.io/i5ting_ztree_toc/build/js/jquery-1.10.2.min.js'&gt;&lt;/script&gt;
&lt;script src='http://i5ting.github.io/i5ting_ztree_toc/build/js/jquery.ztree.all-3.5.js'&gt;&lt;/script&gt;
&lt;script src='http://i5ting.github.io/i5ting_ztree_toc/build/js/jquery.ztree_toc.js'&gt;&lt;/script&gt;
--&gt;
&lt;script src='ztree/jquery-1.10.2.min.js'&gt;&lt;/script&gt;
&lt;script src='ztree/jquery.ztree.all-3.5.js'&gt;&lt;/script&gt;
&lt;script src='ztree/jquery.ztree_toc.js'&gt;&lt;/script&gt;
&lt;SCRIPT type="text/javascript"&gt;
&lt;!--
//documment_selector: '.file-holder'
//documment_selector: '.wiki-holder'
//documment_selector: '.wiki'
$(document).ready(function(){
    $('#tree').ztree_toc({
        is_auto_number:true,
        documment_selector: '.wiki'
    });
});
//--&gt;
&lt;/SCRIPT&gt;
&lt;!--ztree--&gt;

&lt;/body&gt;&lt;/html&gt;
</pre>

</div>
<div id="footer">
<p>
&copy; 2012 - 2015 XStar
&nbsp;|&nbsp;<a href="http://code.google.com/p/vimwiki/" title="vimwiki">Powerby:Vimwiki</a>
&nbsp;|&nbsp;<a href="http://kwiki.github.io" title="丘迟">Style:丘迟</a>
&nbsp;|&nbsp;<a href="../index.html">首页</a>
&nbsp;|&nbsp;<a href="index.html">分类首页</a>
&nbsp;|&nbsp;<a href="../SiteMap.html">站点地图</a>
</p>
</div>
<script type="text/javascript">var vimwiki_rootpath="../";</script>
<script type="text/javascript" src="http://cdn.staticfile.org/jquery/2.0.0/jquery.min.js"></script>
<script type="text/javascript" src="../scripts/vimwiki.js"></script>
</body>
</html>

